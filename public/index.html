<!DOCTYPE html>
<html>

<script type="text/javascript">

/* Copyright (C) 2007 Richard Atterer, richardĀ©atterer.net
   This program is free software; you can redistribute it and/or modify it
   under the terms of the GNU General Public License, version 2. See the file
   COPYING for details. */

var imageNr = 0; // Serial number of current image
var finished = new Array(); // References to img objects which have finished downloading
var paused = false;

function createImageLayer() {
  var img = new Image();
  img.style.position = "absolute";
  img.style.zIndex = -1;
  img.onload = imageOnload;
  img.onclick = imageOnclick;
  img.src = "http://192.168.1.6:9000/?action=snapshot&n=" + (++imageNr);
  var webcam = document.getElementById("webcam");
  webcam.insertBefore(img, webcam.firstChild);
}

// Two layers are always present (except at the very beginning), to avoid flicker
function imageOnload() {
  this.style.zIndex = imageNr; // Image finished, bring to front!
  while (1 < finished.length) {
    var del = finished.shift(); // Delete old image(s) from document
    del.parentNode.removeChild(del);
  }
  finished.push(this);
  if (!paused) createImageLayer();
}

function imageOnclick() { // Clicking on the image will pause the stream
  paused = !paused;
  if (!paused) createImageLayer();
}

</script>
<body onload="createImageLayer();">
<center>

	

	<p><input type="checkbox" id="light" style="display:none"></p>

	<p>
	<table border="0">
		<tr>
		<td></td>
			<td><input type="button" id="move_forward" value="forward" style="width:80px"></td>
		<td></td>
		</tr>
		<tr>
		<td>
			<input type="button" id="move_left" value="left" style="width:80px">
		</td><td>
			<input type="button" id="move_stop" value="stop" style="width:80px">
		</td><td>
			<input type="button" id="move_right" value="right" style="width:80px">
		</td>
		</tr>
		<tr>
		<td>
		</td><td>
			<input type="button" id="move_backward" value="backward" style="width:80px">
		</td><td></td>
		</tr>
	</table>	
	</p>
</center>
	<div id="webcam"><noscript><img src="./?action=snapshot" /></noscript></div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script> <!-- include socket.io client side script -->
<script>
var socket = io(); //load socket.io-client and connect to the host that serves the page

window.addEventListener("load", function(){ //when page loads
  
  var lightbox = document.getElementById("light"); 
  lightbox.addEventListener("change", function() { //add event listener for when checkbox changes
    socket.emit("light", Number(this.checked)); //send button status to server (as 1 or 0)
  });

  var move_forward = document.getElementById("move_forward"); 
	  move_forward.addEventListener("mousedown", function() {
	    socket.emit("move", "forward");
	  });
	  move_forward.addEventListener("mouseup", function() {
	    socket.emit("move", "stop");
  	  });

  var move_backward = document.getElementById("move_backward"); 
	  move_backward.addEventListener("mousedown", function() {
	    socket.emit("move", "backward");
	  });
	  move_backward.addEventListener("mouseup", function() {
	    socket.emit("move", "stop");
  });

  var move_left = document.getElementById("move_left"); 
	  move_left.addEventListener("mousedown", function() {
	    socket.emit("move", "left");
	  });
	  move_left.addEventListener("mouseup", function() {
	    socket.emit("move", "stop");
          });

  var move_right = document.getElementById("move_right"); 
	  move_right.addEventListener("mousedown", function() {
	    socket.emit("move", "right");
  	  });
	  move_right.addEventListener("mouseup", function() {
	    socket.emit("move", "stop");
          });

  var move_stop = document.getElementById("move_stop"); 
	  move_stop.addEventListener("click", function() {
	    socket.emit("move", "stop");
  	  });

});

socket.on('light', function (data) { //get button status from client
  document.getElementById("light").checked = data; //change checkbox according to push button on Raspberry Pi
  socket.emit("light", data); //send push button status to back to server
});
</script>
</html>
</body>
</html>
